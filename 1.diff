From 7f5e24d2bcdfbcd694eeff8c88e0890f165b6e49 Mon Sep 17 00:00:00 2001
From: Aleksandra Zaitceva <Aleksandra_Zaitceva@epam.com>
Date: Wed, 6 Feb 2019 11:33:05 +0400
Subject: [PATCH] [EPMLABSQ-82] final fix

---
 src/component/About.vue           |   2 +-
 src/component/Events.vue          |   5 +-
 src/component/Games.vue           |   2 +-
 src/component/Header.vue          |   2 +-
 src/component/Navigation.vue      |   4 +-
 src/router/index.js               |  11 +-
 src/store/module/eventStore.js    |   9 +
 src/store/module/eventsStore.js   |   2 +-
 src/view/Event.vue                |   4 +-
 src/view/Game.vue                 | 293 +++++++++++++++++++-----------
 10 files changed, 213 insertions(+), 121 deletions(-)


diff --git a/src/component/About.vue b/src/component/About.vue
index 738fafb..3e37e6e 100644
--- a/src/component/About.vue
+++ b/src/component/About.vue
@@ -10,7 +10,7 @@
       <div class="event-button">
         <v-btn class="registration-button white--text" href="/game/5">Правила</v-btn>
         <v-btn class="registration-button white--text" id="twf" v-bind:data-twf-target-state="this.registrationLink">Принять участие</v-btn>
-        <v-btn class="registration-button white--text" href="/event/901674" disabled>О мероприятии</v-btn>
+        <v-btn class="registration-button white--text" href="/event/901674">О мероприятии</v-btn>
       </div>
     </div>
     <div class="abount__margin-wrapper">
diff --git a/src/component/Events.vue b/src/component/Events.vue
index dcd3e10..d744bee 100644
--- a/src/component/Events.vue
+++ b/src/component/Events.vue
@@ -64,7 +64,7 @@ export default {
       }
     })
   },
-  created () {
+  beforeCreate () {
     store.dispatch(CREATE_COMING_EVENT)
     store.dispatch(CREATE_EVENT_LIST)
   },
@@ -152,7 +152,6 @@ export default {
   .event__info{
     height: 100%;
     width: 100%;
-    position: absolute;
     top: 0;
     display: flex;
     flex-direction: column;
diff --git a/src/component/Games.vue b/src/component/Games.vue
index 20e40fa..8de39d9 100644
--- a/src/component/Games.vue
+++ b/src/component/Games.vue
@@ -54,7 +54,7 @@ export default {
       },
       { id: 5,
         title: 'StarMarines',
-        src: '/static/img/games/hsm.PNG',
+        src: '/static/img/games/star_marines.PNG',
         title_all: 'Located two hours south of Sydney in the Southern Highlands of New South Wales, ...',
         status: 'Игра готова',
         isComplite: true
diff --git a/src/router/index.js b/src/router/index.js
index aa2f39f..9187912 100644
--- a/src/router/index.js
+++ b/src/router/index.js
@@ -1,9 +1,10 @@
 import Vue from 'vue'
 import VueRouter from 'vue-router'
 import routes from './routes'
+import store from '@/store'

 Vue.use(VueRouter)
-export default new VueRouter({
+const router = new VueRouter({
   routes,
   mode: 'history',
   scrollBehavior: (to, from, savedPosition) => {
@@ -18,3 +19,11 @@ export default new VueRouter({
     }
   }
 })
+
+router.beforeEach((to, from, next) => {
+  const {dispatch} = to.meta
+  if (dispatch) store.dispatch(dispatch)
+  next()
+})
+
+export default router
diff --git a/src/store/module/eventStore.js b/src/store/module/eventStore.js
index 65a3ee7..fc6f057 100644
--- a/src/store/module/eventStore.js
+++ b/src/store/module/eventStore.js
@@ -37,6 +37,15 @@ const eventInfo = [
     fontColor: '#464547',
     rules: '',
     game_server: 'http://server.codebattle.ru:8080/codebattle'
+  },
+  { id: 901674,
+    gameId: '5',
+    src: '/static/img/games/sm_banner.jpg',
+    fontColor: '#464547',
+    rules: 'Порядок начисления очков и правила расчета для данного мероприятия находятся в разработке.',
+    game_server: 'http://server.codebattle.ru:8080/codebattle',
+    header_image: '/static/img/games/sm_banner.jpg',
+    map_url: 'https://yandex.ru/map-widget/v1/?um=constructor%3Ae7bc1ea2b46583793e2196d40aea02cb59f0e256a03d88abbae8b690162a7e72&amp;source=constructor'
   }
 ]

diff --git a/src/store/module/eventsStore.js b/src/store/module/eventsStore.js
index b6f6b1c..ab0de80 100644
--- a/src/store/module/eventsStore.js
+++ b/src/store/module/eventsStore.js
@@ -59,7 +59,7 @@ export default {
       Promise.all(requests).then(responses => commit('mapRes', responses))
     },
     [CREATE_COMING_EVENT] ({ commit }) {
-      timePadService.getEventList().then(res => console.log(res))
+      timePadService.getEventList().then(res => commit('mapCommingEvent', res))
     },
     [SHOW_SPINNER] ({ commit }) {
       commit('showSpinner')
diff --git a/src/view/Event.vue b/src/view/Event.vue
index b99afa7..913df14 100644
--- a/src/view/Event.vue
+++ b/src/view/Event.vue
@@ -82,7 +82,6 @@ export default {
     },
     ...mapState({
       currentEvent: state => {
-        console.log(state.event.currentEvent)
         return state.event.currentEvent
       }
     })
@@ -154,6 +153,9 @@ export default {
     }
     .event-page {
       font-size: 1.2em;
+      margin: 0 10%;
+      background-color: #fff;
+      background-color: #e3e3e3cc;
     }
     .event-content {
       width: 80%;
diff --git a/src/view/Game.vue b/src/view/Game.vue
index 1c96673..130b589 100644
--- a/src/view/Game.vue
+++ b/src/view/Game.vue
@@ -1,5 +1,5 @@
 <template>
-  <v-content v-bind:style="{ backgroundImage : game.background }">
+  <v-content class="game-page">
     <div id="partners" class="anchor"></div>
     <div id="about" class="anchor"></div>
     <div id="events" class="anchor"></div>
@@ -335,125 +335,174 @@ export default {
           <p>Последней надеждой человечества стали остальные планеты солнечной системы, а вслед за ними и небесные тела соседних систем. За старателями в глубины космоса последовали и немногие оставшиеся «Destro» - сначала под предлогом защиты исследовательских экспедиций от инопланетной угрозы, но вскоре ставшие инструментом новой войны — войны за космос. Поправки Женевской конвенции, утверждённые на саммите ООН, навсегда изменили теорию и практику ведения войн. Отныне человек не принимает больше непосредственного участия в боевых действиях, сохраняя лишь позиции зрителя и «кукловода». Были вытащены на свет древние законы робототехники — мехам запретили наносить вред человеческим существам, предоставив им с упоением уничтожать друг друга.</p>
           <p>В обществе новой эры у людей окончательно отпала надобность в грубой физической силе. В условиях, когда всё тяжёлое и опасное взяли на себя машины, основным навыком стало умение этими машинами качественно управлять. Управление раздробленными до феодализма колониями людей взяли на себя наиболее талантливые программисты - те, что оказались способны подчинить себе бездушный металл мехов.</p>
         </div>
+        <h2 class="description__tittle">Подготовка к турниру</h2>
+        <p>Прежде чем ты примешься за управление бездушными ботами, пройди обязательную регистрацию.</p>
+        <p>Важнейшим этапом подготовки является написание собственного бота на любом языке программирования.  Отладить своего бота ты сможешь в тренировочных боях до старта турнира, доступ к которым появится у тебя после регистрации.</p>
+        <p>Внимание! <br> В боях карты бывают двух типов: карты с большими базами и карты с большим центром. База – это крайние планеты карты. Центр – наоборот =). «Большая» означает, что на планете могут разместится максимальное количество юнитов. Твой бот должен быть настолько хитроумен и адаптивен, что сможет одержать победу в сражении при любом типе карт.</p>
         <h2 class="description__tittle">Как происходит игра</h2>
         <div class="description__main">
           <p>Сервер собирает команды от игроков, участвующих в игре. Раз в две секунды сервер пересчитывает карту с учетом полученных от игроков команд.</p>
           <p>Процесс пересчета юнитов в каждой вершине происходит следующим образом:</p>
           <ul><li>Вычисляется количество юнитов хозяина планеты, с учетом улетевших с этой планеты и прилетевших на нее юнитов этого игрока.</li><li>Получившееся количество увеличивается по правилам регенерации юнитов для этой планеты.</li><li>После этого происходит выбор нового хозяина планеты (в случае, если на планету были посланы чьи-то еще юниты). Хозяином планеты становится игрок с наибольшим количеством юнитов. При этом юниты всех остальных игроков уничтожаются, а у победителя остается число юнитов, на которое он превосходил следующего по численности игрока. <br> <em>Например, если на планете после регенерации было 220 юнитов одного игрока, и еще двое прислали по 100 и 225 юнитов, хозяином планеты станет игрок, приславший 225 юнитов, и на планете останется только 5 юнитов.</em></li></ul>
         </div>
-        <h2 class="description__tittle">Правила регенерации</h2>
+        <h3 class="description__tittle">Правила регенерации</h3>
         <div class="description__main">
           <p>На каждом шаге число юнитов на планете увеличивается. Для каждого типа планет задан процент и предел регенерации. При регенерации количество юнитов на планете увеличивается на заданный процент, но не более предельного количества (при этом на планете может находиться сколь угодно много юнитов, но если их число больше предельного количества, регенерация происходить не будет). На данный момент существуют типы планет со следующими параметрами:</p>
           <ul><li>тип TYPE_A: процент регенерации - 10%, предел - 100 юнитов</li><li>тип TYPE_B: процент регенерации - 15%, предел - 200 юнитов.</li><li>тип TYPE_C: процент регенерации - 20%, предел - 500 юнитов.</li><li>тип TYPE_D: процент регенерации - 30%, предел - 1000 юнитов.</li></ul>
         </div>
-        <h2 class="description__tittle">Что и как отправлять на сервер</h2>
+        <h3 class="description__tittle">Катаклизмы</h3>
+        <p>В начале каждого игрового тика возможно возникновение планетарных или межпланетарных катастроф:</p>
+        <ul>
+          <li>тип METEOR: в любую планету, с вероятностью 5.0% на игровой тик, может врезаться метеор, уничтожив 80.0% находящихся на ней дронов <br>
+            Общее количество катастроф на планетах в каждый момент времени ограничено: их может быть не больше 10.0% от общего количества планет. <br>
+            Катаклизм может продолжаться 2 игровых тиков подряд.
+          </li>
+          <li>тип BLACK_HOLE: между любых планет, с вероятностью 5.0% на игровой тик, может возникнуть черная дыра, уничтожив 100.0% перемещающихся между этими планетами дронов.<br>
+            Количество черных дыр в каждый момент времени также ограничено: их может быть не более 10.0% от общего количества связей между планет (ребер графа).<br>
+            Черная дыра остаётся открытой до 3 игровых тиков.
+          </li>
+        </ul>
+        <h3 class="description__tittle">Порталы</h3>
+        <p>Кроме катаклизмов, в галактике периодически могут открываться червоточины между рандомными планетами, через которые можно отправить своих дронов на планету противника. <br>
+          Портал может открыться в любом гровом тике с вероятностью 20.0% от количества связей между планет, и оставаться открытым в течение 2 тиков.
+          <i>Будьте внимательны, порталы работают в обе стороны!</i>
+        </p>
+        <h3 class="description__tittle">Как подключить бота к серверу</h3>
+        <p>Сервер игры доступен для подключения через веб-сокет по URI <i>/galaxy</i></p>
+        <h3 class="description__tittle">Что и как отправлять на сервер</h3>
         <div class="description__main">
           <p>Идентификация игроков происходит по уникальному ключу, который присваивается каждому игроку при регистрации и может быть изменен по желанию игрока (при условии, что в этот момент игрок не участвует ни в одной игре). Узнать или изменить свой ключ можно на странице "Профиль".</p>
           <p>Запросы на сервер формируются в формате JSON. Для начала игры нужно получить игровое поле, послав пустой список действий.</p>
           <p><b>Важно:</b> при установке соединения по вебсокету необходимо отправить в запросе заголовок "token" с уникальным токеном игрока, который можно посмотреть в разделе "Профиль"</p>
           <p>Если пользователь не участвует ни в одной игре или игра уже закончена, сервер сразу пришлет ответ с соответствующей ошибкой, например:</p>
-          <pre class="code" style="font-size: 17px;">
-            {
-                "planets": [],
-                "errors": [
-                  "User already connected"
-                ]
-              }
-          </pre>
+          <pre class="code" style="font-size: 0.8em;"><code>
+{
+  "planets": [],
+  "errors": ["User already connected"]
+}
+          </code></pre>
           <p>Если игра начата, ответом будет описание игрового поля в следующем виде:</p>
-          <pre class="code" style="font-size: 17px;">
-          {
-              "planets": [
-                {
-                  "id": 64,
-                  "droids": 11,
-                  "owner": "bot",
-                  "type": "TYPE_C",
-                  "neighbours": [
-                    65,
-                    63,
-                    79
-                  ]
-                },
-                {
-                  "id": 65,
-                  "droids": 27,
-                  "owner": "bot",
-                  "type": "TYPE_C",
-                  "neighbours": [
-                    64,
-                    80,
-                    66,
-                    56,
-                    63
-                  ]
-                },
-              // ...
-                {
-                  "id": 62,
-                  "droids": 8,
-                  "owner": "bot6",
-                  "type": "TYPE_B",
-                  "neighbours": [
-                    55,
-                    61,
-                    77,
-                    78,
-                    63,
-                    79
-                  ]
-                },
-                {
-                  "id": 63,
-                  "droids": 12,
-                  "owner": "bot",
-                  "type": "TYPE_B",
-                  "neighbours": [
-                    64,
-                    65,
-                    55,
-                    56,
-                    62,
-                    79
-                  ]
-                }
-              ],
-              "errors": []
-            }
-          </pre>
+<code><pre class="code" style="font-size: 0.8em;">
+{
+  "planets": [
+    {
+      "id": 64,
+      "droids": 11,
+      "owner": "bot",
+      "type": "TYPE_C",
+      "neighbours": [
+        65,
+        63,
+        79
+      ]
+    },
+    {
+      "id": 65,
+      "droids": 27,
+      "owner": "bot",
+      "type": "TYPE_C",
+      "neighbours": [
+        64,
+        80,
+        66,
+        56,
+        63
+      ]
+    },
+  // ...
+    {
+      "id": 62,
+      "droids": 8,
+      "owner": "bot6",
+      "type": "TYPE_B",
+      "neighbours": [
+        55,
+        61,
+        77,
+        78,
+        63,
+        79
+      ]
+    },
+    {
+      "id": 63,
+      "droids": 12,
+      "owner": "bot",
+      "type": "TYPE_B",
+      "neighbours": [
+        64,
+        65,
+        55,
+        56,
+        62,
+        79
+      ]
+    }
+  ],
+  "disasters": [
+    {
+      "type": "BLACK_HOLE",
+      "sourcePlanetId": 9,
+      "targetPlanetId": 7
+    },
+    {
+      "type": "BLACK_HOLE",
+      "sourcePlanetId": 5,
+      "targetPlanetId": 4
+    },
+    // ...
+    {
+      "type": "METEOR",
+      "planetId": 6
+    }
+  ],
+  "portals": [
+    {
+      "source": 11,
+      "target": 9
+    },
+    // ...
+    {
+      "source": 8,
+      "target": 20
+    }
+  ]
+  "errors": []
+}
+</pre></code>
           <p>Исходя из этих данных приложение игрока должно сформировать ответ. Ответ содержит список команд для передвижения юнитов, например:</p>
-          <pre class="code" style="font-size: 17px;">
-          {
-              "token": "a2425yzhzbhly5pbdtezl4puz1wcmttw",
-              "actions": [
-                {
-                  "from": 67,
-                  "to": 66,
-                  "unitsCount": 15
-                },
-                {
-                  "from": 67,
-                  "to": 68,
-                  "unitsCount": 15
-                },
-                {
-                  "from": 67,
-                  "to": 56,
-                  "unitsCount": 18
-                },
-                {
-                  "from": 67,
-                  "to": 57,
-                  "unitsCount": 18
-                },
-                {
-                  "from": 81,
-                  "to": 67,
-                  "unitsCount": 13
-                }
-              ]
-            }
-          </pre>
+          <pre class="code" style="font-size: 0.7em"><code>
+{
+  "token":"a2425yuz1wcmttw",
+  "actions": [
+    {
+      "from": 67,
+      "to": 66,
+      "unitsCount": 15
+    },
+    {
+      "from": 67,
+      "to": 68,
+      "unitsCount": 15
+    },
+    {
+      "from": 67,
+      "to": 56,
+      "unitsCount": 18
+    },
+    {
+      "from": 67,
+      "to": 57,
+      "unitsCount": 18
+    },
+    {
+      "from": 81,
+      "to": 67,
+      "unitsCount": 13
+    }
+  ]
+}
+          </code></pre>
           <p>Ответы на все ошибочные запросы отсылаются сервером почти сразу. Ответ на корректный запрос отсылается сервером после того, как в игре происходит следующий ход, и содержит описание игрового поля после этого хода.</p>
           <p>Важное замечание: если запрос был синтаксически корректен, но некоторые из заданных в нем команд невыполнимы (например, команда переслать юнитов с планеты, не принадлежащей игроку, команда переслать больше юнитов, чем есть на планете и т. п), запрос будет считаться корректным и ответ придет только на следующем шаге. При этом в конце ответа будут добавлены сообщения с обнаруженными ошибками.</p>
           <p>После отсылки сообщения сервер закрывает соединение, и все последующие действия потребуют создания новых соединений.</p>
@@ -501,8 +550,14 @@ export default {
     }
     .game{
       position: absolute;
-      top: 1%;
-      left: 5%;
+      top: 200px;
+      left: 300px;
+    }
+    .game-page {
+      font-size: 1.2em;
+      margin: 0 10%;
+      background-color: #fff;
+      background-color: #e3e3e3cc;
     }
     .game__name {
       display: flex;
@@ -597,14 +652,26 @@ export default {
   }
   .swiper-button-next{
     filter: opacity(70%) grayscale(.80)
+  }
+  @media (max-width: 1024px) {
+    .game{
+      top: 200px;
+      left: 150px;
+    }
+  }
+  @media (max-width: 960px) {
+    .game{
+      top: 200px;
+      left: 150px;
+    }
   }
     @media (max-width: 850px) {
       .game__main{
         display: block;
       }
       .game{
-        top: 3%;
-        left: 4%;
+        top: 100px;
+        left: 50px;
       }
       .game-image {
       height: 300px;
@@ -624,14 +691,17 @@ export default {
       .swiper-button-next{
         filter: opacity(0%)
        }
+      .game-page{
+        margin: 0;
+      }
     }
     @media (max-width: 600px) {
       .game{
-        top: 1%;
-        left: 2%;
+        top: 100px;
+        left: 50px;
       }
       .game-image {
-      height: 170px;
+        height: 170px;
       }
       .game__name {
         font-size: 2.3em;
@@ -646,6 +716,9 @@ export default {
       .game__gallery{
         width: 100%;
       }
+      .game-page {
+        margin: 0;
+      }
       .pictures{
         max-height: 150px;
       }